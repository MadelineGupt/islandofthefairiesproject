<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WebXR Canoe Experience</title>
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-environment-component@1.3.0/dist/aframe-environment-component.min.js"></script>
  <script src="https://cdn.rawgit.com/donmccurdy/aframe-extras/master/dist/aframe-extras.min.js"></script>
  <style>
    body {
      opacity: 0;
      transition: opacity 1.5s ease-in-out;
    }
  </style>
</head>
<body>
  <a-scene>
    <!-- Environment -->
    <a-entity environment="preset: contact; skyType: atmosphere; ground: none; dressing: none; horizonColor: #88ccee"></a-entity>

    <!-- Water -->
    <a-entity id="water"
              geometry="primitive: plane; width: 300; height: 300"
              rotation="-90 0 0"
              position="0 0 -3"
              material="color: #3d7d92; src: water-texture.jpg; shader: standard; metalness: 0.2; roughness: 0.3; opacity: 0.85;">
    </a-entity>

    <!-- Camera Rig -->
    <a-entity id="camera-rig" position="0 8 10" movement-controls="constrainToNavMesh: true">
      <a-entity id="camera" camera position="0 1 0" look-controls>
        <a-cursor color="black"></a-cursor>
      </a-entity>
    </a-entity>

    <!-- Clickable Text Button -->
    <a-entity id="nextButton" position="0 10 -3" class="clickable">
      <a-plane width="6" height="1.2"
               color="#000000"
               opacity="0.001"
               position="0 0 0"
               material="shader: flat; transparent: true">
      </a-plane>
      <a-text value="Take me to Mackinac Island"
              align="center"
              color="#ffffff"
              width="6"
              position="0 0 0.01">
      </a-text>
    </a-entity>

    <!-- Map -->
    <a-image id="map" src="map.png"
             position="0 0.1 -3"
             rotation="-90 0 0"
             width="30" height="24"
             material="shader: standard; metalness: 0.1; roughness: 0.8;"
             animation="property: position.y; from: 0.1; to: 0.2; dur: 3000; dir: alternate; loop: true; easing: easeInOutSine;">
    </a-image>

    <!-- Clickable Orbs -->
    <a-entity id="orbs-container">
      <script>
        let orbPositions = [
          [5.55, -6.25],
          [5.5, -4.75],
          [5.1, -5.25],
          [5.75, -8],
          [5.85, -5.25]
        ];

        for (let i = 0; i < orbPositions.length; i++) {
          document.write(`
            <a-sphere id="orb${i + 1}"
                      position="${orbPositions[i][0]} 0.2 ${orbPositions[i][1]}"
                      radius="0.15"
                      color="#88ccee"
                      emissive="#88ccee"
                      emissiveIntensity="0.7"
                      opacity="0.9"
                      class="clickable"
                      animation="property: scale; from: 1 1 1; to: 1.1 1.1 1.1; dir: alternate; dur: 1000; loop: true">
            </a-sphere>
          `);
        }
      </script>
    </a-entity>
  </a-scene>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      document.body.style.opacity = "1";

      const cameraRig = document.querySelector("#camera-rig");
      const nextButton = document.querySelector("#nextButton");

      // Move the camera down and forward when "Take me to Mackinac Island" is clicked
      nextButton.addEventListener("click", function () {
        cameraRig.setAttribute("animation", {
          property: "position",
          to: "5 0 -4",
          dur: 2000,
          easing: "easeOutQuad"
        });
        nextButton.setAttribute("visible", "false");
      });

      // Clickable orb interaction
      for (let i = 1; i <= 5; i++) {
        document.querySelector(`#orb${i}`).addEventListener("click", function () {
          goToVideo(`https://storage.googleapis.com/islandofthefairies/video${i}.mov`);
        });
      }
    });

    function goToVideo(videoSrc) {
      window.location.href = "video.html?video=" + encodeURIComponent(videoSrc);
    }

    // Paddle Movement
    AFRAME.registerComponent("paddle-movement", {
      init: function () {
        const rig = document.querySelector("#camera-rig");

        window.addEventListener("keydown", function (event) {
          if (event.key === "w" || event.key === "s") {
            let direction = event.key === "w" ? -1 : 1;
            let currentPosition = rig.getAttribute("position");
            rig.setAttribute("animation", {
              property: "position.z",
              to: currentPosition.z + direction * 2,
              dur: 1500,
              easing: "easeOutQuad"
            });
          }
        });
      }
    });

    document.querySelector("#camera-rig").setAttribute("paddle-movement", "");
  </script>
</body>
</html>
