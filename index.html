<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebXR Canoe Experience</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
</head>
<body>
    <a-scene>
        <!-- Soft Sky Background -->
        <a-sky src="sky.jpg"></a-sky>

        <!-- Realistic Water -->
        <a-entity id="water"
                  geometry="primitive: plane; width: 200; height: 200"
                  rotation="-90 0 0"
                  position="0 0 -3"
                  material="src: water-texture.jpg; shader: standard; metalness: 0.2; roughness: 0.1; opacity: 0.9;">
        </a-entity>

        <!-- Camera Rig (Moves as a Canoe) -->
        <a-entity id="camera-rig" position="0 0 0" wasd-controls="acceleration: 2">
            <a-entity id="camera" camera position="0 1.2 0" look-controls>
                <a-cursor color="black"></a-cursor>
            </a-entity>

            <!-- Canoe (With a Sitting Divet) -->
            <a-entity id="canoe" position="0 -0.8 0">
                <!-- Canoe Body (Open Cylinder) -->
                <a-cylinder position="0 0 -1.5" radius="0.7" height="4" open-ended="true"
                            material="src: wood-texture.jpg; shader: standard; side: double; metalness: 0.2; roughness: 0.7;"
                            rotation="90 0 0"></a-cylinder>

                <!-- Canoe Indentation (Divet for Sitting) -->
                <a-torus position="0 0.1 -1.5" radius="0.5" radius-tubular="0.2"
                         material="color: black; opacity: 1; side: double;"></a-torus>

                <!-- Canoe Front & Back Caps -->
                <a-sphere position="0 0 -3.5" radius="0.7"
                          material="src: wood-texture.jpg; shader: standard; metalness: 0.2; roughness: 0.7;"></a-sphere>
                <a-sphere position="0 0 0.5" radius="0.7"
                          material="src: wood-texture.jpg; shader: standard; metalness: 0.2; roughness: 0.7;"></a-sphere>

                <!-- Canoe Rim -->
                <a-cylinder position="0 0.3 -1.5" radius="0.75" height="4" open-ended="true"
                            material="src: wood-texture.jpg; shader: standard; side: double; metalness: 0.2; roughness: 0.7;"
                            rotation="90 0 0"></a-cylinder>
            </a-entity>
        </a-entity>

        <!-- Floating Map -->
        <a-image id="map" src="map.png" position="0 2 -3" width="5" height="6"
                 material="shader: standard; metalness: 0.1; roughness: 0.8;"
                 animation="property: position; from: 0 2 -3; to: 0 2.1 -3; dur: 2000; dir: alternate; loop: true; easing: easeInOutSine">
        </a-image>

        <!-- Clickable Turtle Icons -->
        <a-entity position="0 2 -2.8">
            <a-image id="area1" src="turtle.png" position="-1 0.5 0.1" width="0.3" height="0.3"
                     class="clickable" look-at="#camera"></a-image>

            <a-image id="area2" src="turtle.png" position="1 1 0.1" width="0.3" height="0.3"
                     class="clickable" look-at="#camera"></a-image>
        </a-entity>
    </a-scene>

    <script>
        function goToVideo(videoSrc) {
            window.location.href = "video.html?video=" + encodeURIComponent(videoSrc);
        }

        document.addEventListener("DOMContentLoaded", function () {
            document.querySelector("#area1").addEventListener("click", function () {
                goToVideo("video1.mp4");
            });

            document.querySelector("#area2").addEventListener("click", function () {
                goToVideo("video2.mp4");
            });
        });

        // Canoe Movement + Paddle Animation
        AFRAME.registerComponent("paddle-movement", {
            init: function () {
                let rig = document.querySelector("#camera-rig");
                let paddle = document.querySelector("#paddle");

                window.addEventListener("keydown", function (event) {
                    if (event.key === "w" || event.key === "s") {
                        let direction = event.key === "w" ? -1 : 1;

                        // Move Canoe Forward/Backward Smoothly
                        let currentPosition = rig.getAttribute("position");
                        rig.setAttribute("animation", {
                            property: "position.z",
                            to: currentPosition.z + direction * 2,
                            dur: 1500,
                            easing: "easeOutQuad"
                        });

                        // Paddle Animation (Swings Forward & Back)
                        paddle.setAttribute("animation", {
                            property: "rotation.x",
                            from: "0",
                            to: "-45",
                            dur: 150,  // Faster paddle movement
                            direction: "alternate",
                            easing: "easeInOutSine",
                            loop: 3  // More repetitions to mimic natural paddling
                        });
                    }
                });
            }
        });

        document.querySelector("#camera-rig").setAttribute("paddle-movement", "");
    </script>
</body>
</html>
